<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="domain.Qna_WriteDAO">

	<resultMap type="domain.UserDTO" id="mapUser">
		<result column="u_id" property="id"/>
		<result column="u_username" property="username"/>
		<result column="u_password" property="password"/>
		<result column="u_name" property="name"/>
		<result column="u_authorities" property="authorities"/>
		<result column="u_regdate" property="regDate"/>
		<result column="u_car_name" property="car_name"/>
		<result column="u_car_number" property="car_number"/>
		<result column="u_phone_number" property="phone_number"/>
	</resultMap>
	
	<resultMap type="domain.Qna_WriteDTO" id="mapQWrite">
		<result column="q_id" property="id"/>
		<result column="q_subject" property="subject"/>
		<result column="q_content" property="content"/>
		<result column="q_viewcnt" property="viewcnt"/>
		<result column="q_regdate" property="regDate"/>
		<collection property="user_id" resultMap="mapUser"/>
	</resultMap>
	
	<select id="select" resultMap="mapQWrite">
		SELECT
			q.id "q_id",
			q.subject "q_subject",
			q.content "q_content",
			q.viewcnt "q_viewcnt",
			q.regdate "q_regdate",
			u.id "qu_id",
			u.username "qu_username",
			u.password "qu_password",
			u.name "qu_name",
			u.authorities "qu_authorities",
			u.regdate "qu_regdate",
			u.car_name "qu_car_name",
			u.car_number "qu_car_number",
			u.phone_number "qu_phone_number"
		FROM 
			t404_qna_write q, t404_user u
		WHERE 
			q.user_id = u.id
		ORDER BY 
			q.id DESC
	</select>

	<insert id="insert" flushCache="true"
		parameterType="domain.Qna_WriteDTO"
		keyProperty="id" useGeneratedKeys="true" keyColumn="id">
		INSERT INTO t404_qna_write
			(subject, content, user_id)
		VALUES
			(#{subject}, #{content}, #{user_id.id})
	</insert>

	<!-- 글 조회 -->
	<select id="selectById" resultMap="mapQWrite">
		SELECT
			q.id "q_id",
			q.subject "q_subject",
			q.content "q_content",
			q.viewcnt "q_viewcnt",
			q.regdate "q_regdate",
			u.id "qu_id",
			u.username "qu_username",
			u.password "qu_password",
			u.name "qu_name",
			u.authorities "qu_authorities",
			u.regdate "qu_regdate",
			u.car_name "qu_car_name",
			u.car_number "qu_car_number",
			u.phone_number "qu_phone_number"
		FROM 
			t404_qna_write q, t404_user u
		WHERE 
			q.user_id = u.id AND q.id = #{id}
		ORDER BY 
			q.id DESC
	</select>
	
	<!-- 조회수 증가 -->
	<update id="incViewCnt" flushCache="true">
		UPDATE t404_qna_write
		SET viewcnt = viewcnt + 1
		WHERE id = #{param1}
	</update>
	
	<!-- 글 수정 -->
	<update id="update" flushCache="true"
		parameterType="domain.Qna_WriteDTO">
		UPDATE t404_qna_write
		SET subject = #{subject}, content = #{content}
		WHERE id = #{id}
	</update>
	
	<!-- 글 삭제 -->
	<delete id="deleteById" flushCache="true">
		DELETE FROM t404_qna_write WHERE id = #{id}
	</delete>

	
</mapper>

