<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="domain.Review_WriteDAO">

	<resultMap type="domain.UserDTO" id="mapUser_id">
		<result column="u_id" property="id"/>
		<result column="u_username" property="username"/>
		<result column="u_password" property="password"/>
		<result column="u_name" property="name"/>
		<result column="u_authorities" property="authorities"/>
		<result column="u_regdate" property="regDate"/>
		<result column="u_car_name" property="car_name"/>
		<result column="u_car_number" property="car_number"/>
		<result column="u_phone_number" property="phone_number"/>
	</resultMap>
	
	<resultMap type="domain.ParkingDTO" id="mapParking_id">
		<result column="p_id" property="id"/>
		<result column="p_addr" property="addr"/>
		<result column="p_weekend_begin_time" property="weekend_begin_time"/>
		<result column="p_weekend_end_time" property="weekend_end_time"/>
		<result column="p_weekday_begin_time" property="weekday_begin_time"/>
		<result column="p_weekday_end_time" property="weekday_end_time"/>
		<result column="p_holiday_begin_time" property="holiday_begin_time"/>
		<result column="p_holiday_end_time" property="holiday_end_time"/>
		<result column="p_holiday_pay_nm" property="holiday_pay_nm"/>
		<result column="p_fulltime_monthly" property="fulltime_monthly"/>
		<result column="p_weekend_pay_nm" property="weekend_pay_nm"/>
		<result column="p_saturday_pay_nm" property="saturday_pay_nm"/>
		<result column="p_tel" property="tel"/>
		<result column="p_parking_name" property="parking_name"/>	
	</resultMap>

	<resultMap type="domain.Review_WriteDTO" id="mapReview_Write">
		<result column="r_id" property="id"/>
		<result column="r_subject" property="subject"/>
		<result column="r_content" property="content"/>
		<result column="r_viewcnt" property="viewcnt"/>
		<result column="r_regdate" property="regDate"/>
		<collection property="user_id" resultMap="mapUser_id"/>
		<collection property="parking_id" resultMap="mapParking_id"/>
	</resultMap>

<select id="select" resultMap="mapRWrite">
	SELECT 
			r.id "r_id",
			r.subject "r_subject",
			r.content "r_content", 
			r.viewcnt "r_viewcnt", 
			r.regdate "r_regdate",
			u.id "ru_id",
			u.username "ru_username", 
			u.password "ru_password", 
			u.name "ru_name",
			u.authorities "ru_authorities",
			u.regdate "ru_regdate", 
			u.car_name "ru_car_name",
			u.car_number "ru_car_number",
			u.phone_number "ru_phone_number",
			p.id "p_id",
			p.addr "p_addr", 
			p.weekend_begin_time "p_weekend_begin_time",
			p.weekend_end_time "p_weekend_end_time", 
			p.weekday_begin_time "p_weekday_begin_time", 
			p.weekday_end_time "p_weekday_end_time", 
			p.holiday_begin_time "p_holiday_begin_time", 
			p.holiday_end_time "p_holiday_end_time", 
			p.holiday_pay_nm "p_holiday_pay_nm", 
			p.fulltime_monthly "p_fulltime_monthly", 
			p.weekday_pay_nm "p_weekday_pay_nm", 
			p.saturday_pay_nm "p_saturday_pay_nm", 
			p.tel "p_tel", 
			p.parking_name "p_parking_name"
		FROM
			t404_review_write r, t404_user u, t404_parkinglot p
		WHERE
			r.user_id  = u.id and r.parking_id = p.id
</select>

	<insert id="insert" flushCache="true"
		parameterType="domain.Review_WriteDTO"
		keyProperty="id" useGeneratedKeys="true" keyColumn="id">
		INSERT INTO t404_review_write
			<!-- parking_id = ParkingDTO (Review_WriteDTO 참조)-->
			<!-- parking_id.parkin_name = parkingDTO.getParking_name(); -->
			(subject, content, user_id, parking_id) 
		VALUES
			(#{subject}, #{content}, #{user_id.id}, #{parking_id.parking_name})
	</insert>
	
	<!-- 글 조회 -->
	<select id="selectById" resultMap="mapReview_Write">
		SELECT 
			r.id "r_id",
			r.subject "r_subject",
			r.content "r_content", 
			r.viewcnt "r_viewcnt", 
			r.regdate "r_regdate",
			u.id "ru_id",
			u.username "ru_username", 
			u.password "ru_password", 
			u.name "ru_name",
			u.authorities "ru_authorities",
			u.regdate "ru_regdate", 
			u.car_name "ru_car_name",
			u.car_number "ru_car_number",
			u.phone_number "ru_phone_number",
			p.id "p_id",
			p.addr "p_addr", 
			p.weekend_begin_time "p_weekend_begin_time",
			p.weekend_end_time "p_weekend_end_time", 
			p.weekday_begin_time "p_weekday_begin_time", 
			p.weekday_end_time "p_weekday_end_time", 
			p.holiday_begin_time "p_holiday_begin_time", 
			p.holiday_end_time "p_holiday_end_time", 
			p.holiday_pay_nm "p_holiday_pay_nm", 
			p.fulltime_monthly "p_fulltime_monthly", 
			p.weekday_pay_nm "p_weekday_pay_nm", 
			p.saturday_pay_nm "p_saturday_pay_nm", 
			p.tel "p_tel", 
			p.parking_name "p_parking_name"
		FROM
			t404_review_write r, t404_user u, t404_parkinglot p
		WHERE
			r.user_id  = u.id AND r.id = #{id}
			and r.parking_id = p.id AND p.id = #{id}
			 
        ORDER BY 
        	r.id DESC
	</select>
	
		
	<!-- 조회수 증가 -->
	<update id="incViewCnt" flushCache="true">
		UPDATE t404_review_write
		SET viewcnt = viewcnt + 1
		WHERE id = #{param1}
	</update>

	<!-- 글수정 -->
	<update id="update" flushCache="true"
		parameterType="domain.Review_WriteDTO">
		UPDATE t404_review_write
		SET subject = #{subject}, content = #{content}
		WHERE id = #{id}
	</update>
	
	<!-- 글삭제 -->
	<delete id="deleteById" flushCache="true">
		DELETE FROM t404_review_write WHERE id = #{id}
	</delete>
	
	<!-- 페이징 용 쿼리
	<select id="selectFromRow" resultMap="mapReview_Write">
		<include refid="SELECTWRITE"/>
		ORDER BY r.id DESC
		LIMIT #{param1}, #{param2}
	</select>
	
	<select id="countAll" resultType="int">
		SELECT count(*) FROM t404_review_write
	</select>  -->
	

</mapper>